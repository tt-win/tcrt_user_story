# User Story Map 快速參考指南

## 部署步驟

### 1. 資料庫遷移
執行遷移腳本以更新現有資料：

```bash
cd /Users/hideman/code/tcrt_user_story
python3 scripts/migrate_usm_db.py
```

### 2. 重啟服務
```bash
./stop.sh
./start.sh
```

## 新功能使用指南

### 樹狀圖自動排版
1. 打開任一 User Story Map
2. 點擊工具列的「自動排版」按鈕
3. 系統會自動將節點排列成由左至右的樹狀結構

### 團隊資訊
- 地圖所屬團隊名稱會自動套用到所有節點
- 新增節點時會顯示目前團隊資訊，無需手動輸入
- 節點屬性面板與卡片徽章同步顯示團隊名稱

### 票證聚合
1. 為節點和子節點設定 JIRA tickets
2. 點擊頂部的「計算票證」按鈕
3. 系統會自動計算每個節點及其所有子節點的 tickets
4. 在節點屬性面板中查看「聚合 Tickets」欄位

### 路徑高亮
1. 在地圖上選擇一個節點
2. 點擊「高亮路徑」按鈕
3. 從根節點到選定節點的路徑會保持清晰
4. 其他節點和連線會自動淡化
5. 點擊「清除高亮」返回正常視圖

### 進階搜尋
1. 點擊「搜尋」按鈕
2. 輸入搜尋條件：
   - 文字（標題、描述、註解）
   - JIRA Ticket 編號
3. 符合條件的節點會在地圖上以陰影高亮顯示
4. 搜尋結果列表顯示詳細資訊

## 鍵盤快捷鍵

- **拖曳畫布**：滑鼠左鍵拖曳
- **縮放**：滑鼠滾輪
- **拖曳節點**：選中節點後拖曳
- **連接節點**：從節點邊緣拖曳連接點到另一個節點

## API 端點

### 計算聚合票證
```
POST /api/user-story-maps/{map_id}/calculate-aggregated-tickets
```

### 獲取節點路徑
```
GET /api/user-story-maps/{map_id}/path/{node_id}
```

返回從根節點到指定節點的完整路徑。

## 資料格式

### 節點屬性補充
```json
{
  "team": "Team A",
  "aggregated_tickets": ["PROJ-123", "PROJ-456"],
  "level": 1
}
```

## 最佳實踐

### 地圖組織
1. 使用 Root 節點作為起點
2. Epic 層級放在第一層
3. Feature 放在第二層
4. User Story 放在第三層
5. Task 放在最底層

### 團隊協作
1. 確認節點顯示的團隊名稱正確
2. 於註解記錄其他協作團隊資訊
3. 使用票證追蹤跨團隊工作

### 票證管理
1. 在最底層節點（Task）添加具體的 JIRA tickets
2. 定期點擊「計算票證」更新聚合資料
3. 使用聚合票證追蹤上層節點的完整工作範圍

### 視覺化優化
1. 定期使用「自動排版」保持結構清晰
2. 使用「適應畫面」快速查看全局
3. 使用「路徑高亮」聚焦於特定功能線

## 故障排除

### 節點無法連接
- 確保從節點邊緣的連接點開始拖曳
- 檢查目標節點是否可見

### 自動排版效果不理想
- 確認所有節點都有正確的 parent-child 關係
- 檢查是否有循環引用
- 手動調整部分節點位置後再使用自動排版

### 搜尋無結果
- 檢查搜尋條件是否過於嚴格
- 確認已選擇正確的地圖
- 嘗試使用更寬鬆的關鍵字

### 票證計算不正確
- 確認子節點關係設定正確（parent_id 和 children_ids）
- 檢查是否有循環引用
- 重新儲存地圖後再計算

## 效能優化建議

- 單個地圖建議不超過 200 個節點
- 定期清理不需要的連線
- 複雜地圖考慮拆分為多個子地圖
- 使用 MiniMap 快速導航大型地圖

## 相關文件

- [完整功能說明](./USER_STORY_MAP_FEATURES.md)
- [API 文件](../app/api/user_story_maps.py)
- [資料模型](../app/models/user_story_map.py)
